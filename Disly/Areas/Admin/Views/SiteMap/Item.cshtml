@model SiteMapViewModel

@using (Html.BeginForm("Item", "SiteMap", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    if (Model.UserResolution.Read)
    {
        <div class="content">
            <h1>@ViewBag.Title</h1>
            @Html.Partial("Partial/BreadCrumbSiteMap", Model.BreadCrumbs)
            @Html.TextBoxFor(m => m.Item.Title, new { @title = "Название", @required = "" })
            @Html.TextBoxFor(m => m.Item.Alias, new { @title = "Алиас" })
            @Html.TextBoxFor(m => m.Item.Url, new { @title = "Ссылка" })

            <div class="group-block" title="Текст">
                @Html.TextAreaFor(m => m.Item.Text, new { @type = "editor", @height = "300" })
            </div>
            
            <div class="row">
                <div class="col-sm-5">
                    <h3 class="nesting_title">Список вложенностей</h3>
                </div>
                <div class="col-sm-7">
                    <div class="bubble_but">
                        @if (Model.UserResolution.Write && Model.Item != null)
                        {
                            <a class="button icon-create green" href="/admin/sitemap/item/@Guid.NewGuid()/?parent=@Model.Item.Id">Добавить</a>
                        }
                        @if (Model.Childrens != null && Model.Childrens.Count() > 1)
                        {
                            <a class="button icon-sort" value="no-preloader-btn" id="sorting_element" title="Добавляет возможность сортировки элементов списка">Сортировать</a>
                        }
                    </div>
                </div>
            </div>

            @if (Model.Childrens != null)
            {
                <div class="site_map_list">
                    <table id="sm_list" class="table table-striped">
                        <thead>
                            <tr>
                                <th class="map_site_icon">&nbsp;</th>
                                <th class="map_site_title">Название</th>
                                <th class="map_site_attach">Вложения</th>
                            </tr>
                        </thead>
                        <tbody data-service="/Admin/Services/ChangePermit?group=SiteMap">
                            @foreach (var item in Model.Childrens)
                            {
                                <tr class="ui-sortable-handle" data-id="@item.Id">
                                    @if (item.Alias != " ")
                                    {
                                        string disabled = item.Disabled ? "disabled" : String.Empty;

                                        string _class = String.Empty;
                                        if (!String.IsNullOrEmpty(item.Url))
                                        {
                                            _class = "icon-site-link";
                                        }
                                        else if (item.CountSibling == 0)
                                        {
                                            _class = "icon-site-page";
                                        }
                                        else
                                        {
                                            _class = "icon-site-folder";
                                        }

                                        <td class="map_site_icon disabled"></td>
                                        <td class="@_class @disabled"><a href="/admin/sitemap/item/@item.Id">@item.Title</a></td>
                                        <td class="sort-element @disabled">@item.CountSibling</td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
                <div class="dop_info-block">
                    @Html.DropDownListFor(m => m.Item.FrontSection, new SelectList(Model.FrontSectionList, "value", "text", "page"), new { @title = "Шаблон", @class = "selectpicker", @data_help = "Выбор шаблона страницы", @required = "" })
                    @*@Html.DropDownListFor(m => m.Item.MenuGroups, new MultiSelectList(Model.MenuTypes, "value", "text", Model.Item.MenuGroups), new { @title = "Группы меню", @class = "selectpicker", @multiple = "multiple" })*@
                    @Html.DropDownListFor(m => m.Item.MenuGroups, (MultiSelectList)ViewBag.GroupMenu, new { @title = "Группы меню", @class = "selectpicker", @multiple = "multiple" })
                    <div class="group-block" title="Мета теги">
                        @Html.TextAreaFor(m => m.Item.Keyw, new { type = "text", title = "Ключевые слова", data_help = "Данный тег используется при создании краткого описания страницы, используется поисковыми системами для индексации, а также при создании аннотации в выдаче по запросу. При отсутствии тега поисковые системы выдают в аннотации первую строку документа или отрывок, содержащий ключевые слова." })
                        @Html.TextAreaFor(m => m.Item.Desc, new { type = "text", title = "Краткое описание", data_help = "Данный метатег поисковые системы используют для того, чтобы определить релевантность ссылки. При формировании данного тега необходимо использовать только те слова, которые содержатся в самом документе. Использование тех слов, которых нет на странице, не рекомендуется. Рекомендованное количество слов в данном теге — не более десяти." })
                    </div>
                    @Html.CheckBoxFor(m => m.Item.Disabled, new { @class = "checkbox", @title = "Запретить просмотр", @data_toggle = "toggle", @data_help = "Запретить просмотр", @data_off = "Доступ разрешён", @data_on = "Доступ запрещён", @data_onstyle = "danger", @data_offstyle = "success", @data_width = "248" })
                    @Html.CheckBoxFor(m => m.Item.DisabledMenu, new { @class = "checkbox", @title = "Запретить в меню", @data_toggle = "toggle", @data_help = "Запретить в меню", @data_off = "Доступ разрешён", @data_on = "Доступ запрещён", @data_onstyle = "danger", @data_offstyle = "success", @data_width = "248" })
                    @if (Model.Item != null)
                    {
                        @Html.ActionLink("Журнал изменений", "log", "services", new { @id = Model.Item.Id }, new { @id = "LogLists", @class = "button pop-up_frame icon-archive", @data_class = "LogList", @title = "Журнал изменений" })
                    }
                </div>
    }
    else
    {
        <div class="content">
            <p>У Вас недостаточно прав.</p>
        </div>
    }

    <div class="buttons">
        @if ((Model.Item != null && Model.UserResolution.Change) || (Model.Item == null && Model.UserResolution.Write))
        {
            <button type="submit" name="action" value="save-btn" data-primary="true" class="button icon-create">Сохранить</button>
        }
        @if (Model.Item != null && Model.UserResolution.Delete)
        {
            <button type="submit" name="action" value="delete-btn" class="button icon-delete">Удалить</button>
        }
        <button type="submit" name="action" value="cancel-btn" class="button icon-cancel">Закрыть</button>
    </div>
}


